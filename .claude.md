# Instrucciones de Desarrollo - Transaction SÃ©ance

## ğŸ¯ Principios Fundamentales

### 1. **ReutilizaciÃ³n de CÃ³digo**
- SIEMPRE buscar componentes, utilidades o funciones existentes antes de crear nuevos
- Usar los patrones establecidos en el proyecto
- Mantener la consistencia con el cÃ³digo existente

### 2. **Variables de Entorno**
- **NUNCA** hardcodear valores configurables
- **SIEMPRE** usar variables de entorno para:
  - Direcciones de wallet/contratos
  - URLs y endpoints
  - Fees y montos
  - API keys
  - Configuraciones de red
- Usar el patrÃ³n con fallback seguro:
  ```typescript
  const VALUE = process.env.NEXT_PUBLIC_VALUE || 'fallback-value';
  ```
- Para direcciones Ethereum:
  ```typescript
  const ADDRESS = getAddress(
    (process.env.NEXT_PUBLIC_ADDRESS || '0xDefaultAddress...') as `0x${string}`
  );
  ```

### 3. **Seguridad**
- Validar TODAS las entradas de usuario
- Usar `getAddress()` de viem para validar direcciones Ethereum
- Nunca exponer API keys o secretos en el cÃ³digo cliente
- Implementar rate limiting cuando sea necesario
- Validar tipos con TypeScript estricto
- Prevenir inyecciones (SQL, XSS, Command Injection)

### 4. **Estructura del Proyecto**

```
transaction-seance/
â”œâ”€â”€ app/                    # Next.js 14 App Router
â”‚   â”œâ”€â”€ api/               # API Routes
â”‚   â”‚   â””â”€â”€ ghost/         # Endpoint de fantasmas
â”‚   â”œâ”€â”€ page.tsx           # PÃ¡gina principal
â”‚   â”œâ”€â”€ layout.tsx         # Layout raÃ­z
â”‚   â””â”€â”€ providers.tsx      # Providers de contexto
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ ghost/            # Componentes relacionados con fantasmas
â”‚   â”œâ”€â”€ wallet/           # Componentes de wallet
â”‚   â””â”€â”€ ui/               # Componentes UI reutilizables
â”œâ”€â”€ lib/                  # LÃ³gica de negocio y utilidades
â”‚   â”œâ”€â”€ api/             # Funciones de API
â”‚   â”œâ”€â”€ generators/      # Generadores (fantasmas, nombres, etc.)
â”‚   â”œâ”€â”€ i18n/           # InternacionalizaciÃ³n
â”‚   â”œâ”€â”€ types/          # Tipos TypeScript
â”‚   â””â”€â”€ wagmi/          # ConfiguraciÃ³n Wagmi/Wallet
â”œâ”€â”€ public/              # Assets estÃ¡ticos
â””â”€â”€ .env.local          # Variables de entorno (NO commitear)
```

## ğŸ“‹ Patrones a Seguir

### Componentes React

```typescript
'use client'; // Solo si necesita interactividad

import { useState, useEffect } from 'react';
import { useLanguage } from '@/lib/i18n/context/LanguageContext';

interface ComponentProps {
  // Definir props con TypeScript
}

export function Component({ prop }: ComponentProps) {
  // 1. Hooks primero
  const { t } = useLanguage();
  const [state, setState] = useState<Type>(initialValue);
  
  // 2. Efectos
  useEffect(() => {
    // Logic
  }, [dependencies]);
  
  // 3. Funciones
  const handleAction = () => {
    // Logic
  };
  
  // 4. Render
  return (
    <div className="responsive-classes">
      {/* JSX */}
    </div>
  );
}
```

### API Routes

```typescript
import { NextResponse } from 'next/server';

export async function GET(request: Request) {
  try {
    // 1. Obtener parÃ¡metros
    const { searchParams } = new URL(request.url);
    const param = searchParams.get('param') || 'default';
    
    // 2. Validar
    if (!isValid(param)) {
      return NextResponse.json(
        { error: 'Invalid parameter' },
        { status: 400 }
      );
    }
    
    // 3. Procesar
    const result = await processData(param);
    
    // 4. Retornar
    return NextResponse.json({ data: result });
  } catch (error) {
    console.error('Error:', error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'Unknown error' },
      { status: 500 }
    );
  }
}
```

### InternacionalizaciÃ³n

```typescript
// Usar SIEMPRE el hook useLanguage
const { t, language } = useLanguage();

// En JSX
<p>{t.page.title}</p>
<p>{t.technical.transactionHash}</p>

// Para textos dinÃ¡micos, usar funciones en el diccionario
{t.page.alerts.shareText(ghost.name, ghost.story, rarity)}
```

### Estilos con Tailwind

- Usar clases responsive: `text-sm sm:text-base md:text-lg`
- Mobile-first: diseÃ±ar primero para mÃ³vil
- Usar clases de utilidad en lugar de CSS personalizado
- Patrones comunes:
  - Botones: `bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-gray-700`
  - Cards: `border-2 border-gray-300 rounded-lg p-4 bg-white`
  - Touch: `touch-manipulation active:scale-95`

## ğŸ”§ ConfiguraciÃ³n

### Variables de Entorno Requeridas

Siempre mantener actualizado `.env.example` con:

```bash
# API Keys
NEXT_PUBLIC_ETHERSCAN_API_KEY=

# Blockchain Config
NEXT_PUBLIC_BASE_CHAIN_ID=8453
NEXT_PUBLIC_BASE_RPC_URL=https://mainnet.base.org

# Wallet & Fees
NEXT_PUBLIC_TREASURY_ADDRESS=
NEXT_PUBLIC_INVOCATION_FEE=

# Farcaster
NEXT_PUBLIC_BASE_URL=
```

### Agregar Nueva Variable de Entorno

1. AÃ±adir a `.env.local` (desarrollo)
2. AÃ±adir a `.env.example` (documentaciÃ³n)
3. Usar en cÃ³digo con fallback
4. Documentar en README.md si es necesario
5. Actualizar tipos TypeScript si aplica

## ğŸ›¡ï¸ Checklist de Seguridad

Antes de cada commit, verificar:

- [ ] No hay API keys o secretos hardcodeados
- [ ] Todas las direcciones usan `getAddress()` de viem
- [ ] ValidaciÃ³n de entrada en todas las funciones pÃºblicas
- [ ] Manejo de errores apropiado (try/catch)
- [ ] Variables de entorno con fallbacks seguros
- [ ] No hay SQL/XSS/Command injection posible
- [ ] Tipos TypeScript correctos (no `any` sin justificaciÃ³n)

## ğŸ“¦ Dependencias Clave

```json
{
  "wagmi": "^2.x",           // Wallet integration
  "viem": "^2.x",            // Ethereum utilities
  "@tanstack/react-query": "^5.x", // Data fetching
  "@farcaster/miniapp-sdk": "latest", // Farcaster integration
  "next": "^15.x",           // Framework
  "tailwindcss": "^3.x"      // Styling
}
```

## ğŸš€ Desarrollo

### Comandos Comunes

```bash
# Desarrollo
npm run dev

# Build
npm run build

# Linting
npm run lint

# Testing con ngrok
ngrok http 3000
```

### Flujo de Trabajo

1. **Antes de empezar:**
   - Revisar estructura existente
   - Buscar componentes reutilizables
   - Planificar quÃ© variables de entorno se necesitan

2. **Durante desarrollo:**
   - Usar TypeScript estricto
   - Seguir patrones establecidos
   - Comentar cÃ³digo complejo
   - Mantener componentes pequeÃ±os y enfocados

3. **Antes de finalizar:**
   - Verificar que no hay hardcodeo
   - Actualizar `.env.example` si aÃ±adiste variables
   - Probar en mÃ³vil y desktop
   - Verificar que compila sin warnings

## ğŸ¨ Convenciones de CÃ³digo

### Naming

- Componentes: PascalCase (`GhostCard`, `ConnectWallet`)
- Funciones: camelCase (`handleClick`, `fetchGhost`)
- Constantes: UPPER_CASE (`TREASURY_ADDRESS`, `INVOCATION_FEE`)
- Archivos: kebab-case (`ghost-generator.ts`, `connect-wallet.tsx`)

### Imports

```typescript
// 1. React y Next.js
import { useState } from 'react';
import { NextResponse } from 'next/server';

// 2. LibrerÃ­as externas
import { useAccount } from 'wagmi';
import { parseEther } from 'viem';

// 3. Componentes locales
import { GhostCard } from '@/components/ghost/GhostCard';

// 4. Utilidades y tipos
import { Ghost } from '@/lib/types/ghost';
import { useLanguage } from '@/lib/i18n/context/LanguageContext';
```

### Comentarios

```typescript
// âœ… Bueno: Explica el "por quÃ©"
// Retry hasta 10 veces para garantizar que usuarios que pagaron obtengan un fantasma
const maxAttempts = 10;

// âŒ Malo: Explica el "quÃ©" (obvio del cÃ³digo)
// Incrementar contador
attempts++;
```

## ğŸ› Debugging

### Logs Ãštiles

```typescript
// Desarrollo
console.log('ğŸ” Debug:', value);
console.log('âœ… Success:', result);
console.log('âŒ Error:', error);

// ProducciÃ³n: solo errores crÃ­ticos
console.error('Critical error:', error);
```

### Errores Comunes

1. **Hydration mismatch:** Usar `mounted` state para SSR
2. **Invalid address:** Usar `getAddress()` de viem
3. **Undefined env vars:** Siempre tener fallback
4. **Type errors:** Definir interfaces correctamente

## ğŸ“š Recursos

- Next.js 14 Docs: https://nextjs.org/docs
- Wagmi Docs: https://wagmi.sh
- Viem Docs: https://viem.sh
- Tailwind Docs: https://tailwindcss.com
- Farcaster Mini Apps: https://docs.farcaster.xyz/developers/frames/v2

## âš¡ Performance

- Usar `loading="lazy"` en imÃ¡genes
- Implementar code splitting cuando sea necesario
- Evitar re-renders innecesarios (React.memo, useMemo)
- Optimizar importaciones (tree shaking)
- Lazy load componentes pesados

## ğŸŒ InternacionalizaciÃ³n

- Soportar ES y EN
- Textos en `lib/i18n/translations/`
- Usar hook `useLanguage()`
- Nunca hardcodear strings visibles al usuario
- Formato de fechas/nÃºmeros segÃºn locale

---

**Recuerda:** El cÃ³digo debe ser mantenible, seguro y escalable. Cuando tengas dudas, pregunta antes de implementar.
